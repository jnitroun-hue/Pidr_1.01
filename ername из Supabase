warning: in the working copy of 'src/store/gameStore.tsx', LF will be replaced by CRLF the next time Git touches it
[1mdiff --git a/src/store/gameStore.tsx b/src/store/gameStore.tsx[m
[1mindex 5fda36b..65d2686 100644[m
[1m--- a/src/store/gameStore.tsx[m
[1m+++ b/src/store/gameStore.tsx[m
[36m@@ -53,8 +53,6 @@[m [minterface GameState {[m
   // –ò–≥—Ä–æ–≤–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ[m
   isGameActive: boolean[m
   gameMode: 'single' | 'multiplayer'[m
[31m-  currentRound: number[m
[31m-  maxRounds: number[m
   players: Player[][m
   currentPlayerId: string | null[m
   deck: Card[][m
[36m@@ -268,8 +266,6 @@[m [mexport const useGameStore = create<GameState>()([m
       // –ù–∞—á–∞–ª—å–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ[m
       isGameActive: false,[m
       gameMode: 'single',[m
[31m-      currentRound: 0,[m
[31m-      maxRounds: 10,[m
       players: [],[m
       currentPlayerId: null,[m
       deck: [...DEFAULT_CARDS],[m
[36m@@ -391,21 +387,31 @@[m [mexport const useGameStore = create<GameState>()([m
         const players: Player[] = [][m
         const cardsPerPlayer = 3;[m
         [m
[31m-        // –ò–°–ü–†–ê–í–õ–ï–ù–û: –°–æ–∑–¥–∞–µ–º –∏–≥—Ä–æ–∫–æ–≤ —Å —Ä–µ–∞–ª—å–Ω—ã–º–∏ –¥–∞–Ω–Ω—ã–º–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∏–∑ Supabase –ë–î[m
[31m-        console.log('üéÆ [GameStore] –°–æ–∑–¥–∞–µ–º –∏–≥—Ä–æ–∫–æ–≤...');[m
[32m+[m[32m        // –ò–°–ü–†–ê–í–õ–ï–ù–û: –ó–ê–ì–†–£–ñ–ê–ï–ú –¥–∞–Ω–Ω—ã–µ —Ä–µ–∞–ª—å–Ω–æ–≥–æ –∏–≥—Ä–æ–∫–∞ –∏–∑ Supabase –ë–î —á–µ—Ä–µ–∑ API[m
[32m+[m[32m        console.log('üéÆ [GameStore] –ó–∞–≥—Ä—É–∂–∞–µ–º –¥–∞–Ω–Ω—ã–µ –∏–≥—Ä–æ–∫–∞ –∏–∑ –ë–î...');[m
         [m
[31m-        const userAvatar = userInfo?.avatar || '';[m
[31m-        const userName = userInfo?.username || '–ò–≥—Ä–æ–∫'; // Fallback –Ω–∞ "–ò–≥—Ä–æ–∫" –≤–º–µ—Å—Ç–æ "–í—ã"[m
[32m+[m[32m        let userAvatar = '';[m
[32m+[m[32m        let userName = '–ò–≥—Ä–æ–∫';[m
         [m
[31m-        console.log('üéÆ [GameStore] –î–∞–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è:', { userAvatar, userName });[m
[32m+[m[32m        try {[m
[32m+[m[32m          const response = await fetch('/api/auth', { credentials: 'include' });[m
[32m+[m[32m          if (response.ok) {[m
[32m+[m[32m            const result = await response.json();[m
[32m+[m[32m            if (result.success && result.user) {[m
[32m+[m[32m              userAvatar = result.user.avatar_url || '';[m
[32m+[m[32m              userName = result.user.username || '–ò–≥—Ä–æ–∫';[m
[32m+[m[32m              console.log('‚úÖ [GameStore] –î–∞–Ω–Ω—ã–µ –∏–≥—Ä–æ–∫–∞ –∑–∞–≥—Ä—É–∂–µ–Ω—ã –∏–∑ –ë–î:', { userName, avatar: userAvatar ? '–µ—Å—Ç—å' : '–Ω–µ—Ç' });[m
[32m+[m[32m            }[m
[32m+[m[32m          }[m
[32m+[m[32m        } catch (error) {[m
[32m+[m[32m          console.error('‚ùå [GameStore] –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö –∏–≥—Ä–æ–∫–∞:', error);[m
[32m+[m[32m        }[m
         [m
         const playerInfos = createPlayers(playersCount, 0, userAvatar, userName);[m
[31m-        console.log('üéÆ [GameStore] –ò–≥—Ä–æ–∫–∏ —Å–æ–∑–¥–∞–Ω—ã:', playerInfos);[m
         [m
         for (let i = 0; i < playersCount; i++) {[m
           const playerInfo = playerInfos[i];[m
           [m
[31m-          // –ü—Ä–æ–≤–µ—Ä—è–µ–º —á—Ç–æ playerInfo –∫–æ—Ä—Ä–µ–∫—Ç–µ–Ω[m
           if (!playerInfo) {[m
             throw new Error(`–ù–µ —É–¥–∞–ª–æ—Å—å —Å–æ–∑–¥–∞—Ç—å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –¥–ª—è –∏–≥—Ä–æ–∫–∞ ${i + 1}`);[m
           }[m
[36m@@ -439,8 +445,6 @@[m [mexport const useGameStore = create<GameState>()([m
             }[m
           }[m
           [m
[31m-          console.log(`üéÆ [GameStore] –°–æ–∑–¥–∞–µ–º –∏–≥—Ä–æ–∫–∞ ${i + 1}:`, playerInfo);[m
[31m-          [m
           const newPlayer = {[m
             id: `player_${i + 1}`,[m
             name: playerInfo.name,[m
[36m@@ -456,13 +460,6 @@[m [mexport const useGameStore = create<GameState>()([m
           };[m
           [m
           players.push(newPlayer);[m
[31m-          [m
[31m-          console.log(`üéÆ [GameStore] –ò–≥—Ä–æ–∫ ${i + 1} —Å–æ–∑–¥–∞–Ω:`, {[m
[31m-            name: newPlayer.name,[m
[31m-            isUser: newPlayer.isUser,[m
[31m-            isBot: newPlayer.isBot,[m
[31m-            avatar: newPlayer.avatar ? '–µ—Å—Ç—å' : '–Ω–µ—Ç'[m
[31m-          });[m
         }[m
         [m
         // –û—Å—Ç–∞–≤—à–∏–µ—Å—è –∫–∞—Ä—Ç—ã –≤ –∫–æ–ª–æ–¥–µ[m
[36m@@ -1144,35 +1141,25 @@[m [mexport const useGameStore = create<GameState>()([m
         const { deck, gameStage, lastPlayerToDrawCard, players } = get();[m
         if (gameStage !== 1 || deck.length > 0) return;[m
         [m
[31m-        console.log(`üéØ [checkStage1End] ‚úÖ 1-—è —Å—Ç–∞–¥–∏—è –∑–∞–≤–µ—Ä—à–µ–Ω–∞! –ü–µ—Ä–µ—Ö–æ–¥ –≤–æ 2-—é —Å—Ç–∞–¥–∏—é...`);[m
[31m-        [m
[31m-        // –û–ø—Ä–µ–¥–µ–ª—è–µ–º –∫–æ–∑—ã—Ä—å –≤—Ç–æ—Ä–æ–π —Å—Ç–∞–¥–∏–∏[m
[31m-        const trumpSuit = get().determineTrumpSuit();[m
[31m-[m
[31m-        console.log(`üéØ [checkStage1End] –ö–æ–∑—ã—Ä—å –æ–ø—Ä–µ–¥–µ–ª–µ–Ω: ${trumpSuit || '–ù–ï–¢'}`);[m
[32m+[m[32m        console.log(`üéØ [checkStage1End] ‚úÖ 1-—è —Å—Ç–∞–¥–∏—è –∑–∞–≤–µ—Ä—à–µ–Ω–∞! –ü–µ—Ä–µ—Ö–æ–¥ –≤–æ 2-—é —Å—Ç–∞–¥–∏—é (–û–¢–ö–†–´–¢–ò–ï –ü–ï–ù–¨–ö–û–í)...`);[m
         [m
         // –û–ø—Ä–µ–¥–µ–ª—è–µ–º —Å—Ç–∞—Ä—Ç–æ–≤–æ–≥–æ –∏–≥—Ä–æ–∫–∞ (–ø–æ—Å–ª–µ–¥–Ω–∏–π –≤–∑—è–≤—à–∏–π –∫–∞—Ä—Ç—É)[m
         const startingPlayerId = lastPlayerToDrawCard || players[0].id;[m
[31m-[m
[31m-        console.log(`üéØ [checkStage1End] –°—Ç–∞—Ä—Ç–æ–≤—ã–π –∏–≥—Ä–æ–∫: ${players.find(p => p.id === startingPlayerId)?.name}`);[m
         [m
[31m-        // –û–±–Ω–æ–≤–ª—è–µ–º —Ç–µ–∫—É—â–µ–≥–æ –∏–≥—Ä–æ–∫–∞ –∏ –ø–µ—Ä–µ–≤–æ–¥–∏–º –≤—Å–µ—Ö –≤–æ 2-—é —Å—Ç–∞–¥–∏—é[m
[31m-        // –ò–°–ü–†–ê–í–õ–ï–ù–û: –û—Ç–∫—Ä—ã–≤–∞–µ–º –ø–µ–Ω—å–∫–∏ –¥–ª—è —Ç–µ—Ö —É –∫–æ–≥–æ –Ω–µ—Ç –æ—Ç–∫—Ä—ã—Ç—ã—Ö –∫–∞—Ä—Ç[m
[32m+[m[32m        // –°–¢–ê–î–ò–Ø 2: –¢–û–õ–¨–ö–û –û–¢–ö–†–´–¢–ò–ï –ü–ï–ù–¨–ö–û–í –£ –í–°–ï–• –ò–ì–†–û–ö–û–í![m
         players.forEach(p => {[m
[31m-          p.isCurrentPlayer = p.id === startingPlayerId;[m
[32m+[m[32m          p.isCurrentPlayer = false; // –ù–∏–∫—Ç–æ –Ω–µ —Ö–æ–¥–∏—Ç –≤–æ 2-–π —Å—Ç–∞–¥–∏–∏[m
           p.playerStage = 2; // –í—Å–µ –ø–µ—Ä–µ—Ö–æ–¥—è—Ç –≤–æ 2-—é —Å—Ç–∞–¥–∏—é[m
           [m
[31m-          // –ö–†–ò–¢–ò–ß–ï–°–ö–ò –í–ê–ñ–ù–û: –ï—Å–ª–∏ —É –∏–≥—Ä–æ–∫–∞ –Ω–µ—Ç –æ—Ç–∫—Ä—ã—Ç—ã—Ö –∫–∞—Ä—Ç - –æ—Ç–∫—Ä—ã–≤–∞–µ–º –ø–µ–Ω—å–∫–∏ –°–†–ê–ó–£![m
[31m-          const hasOpenCards = p.cards.some(c => c.open);[m
[31m-          if (!hasOpenCards && p.penki.length > 0) {[m
[31m-            console.log(`üÉè [checkStage1End] ‚ö†Ô∏è –£ –∏–≥—Ä–æ–∫–∞ ${p.name} –Ω–µ—Ç –æ—Ç–∫—Ä—ã—Ç—ã—Ö –∫–∞—Ä—Ç - –æ—Ç–∫—Ä—ã–≤–∞–µ–º –ø–µ–Ω—å–∫–∏ –°–†–ê–ó–£!`);[m
[32m+[m[32m          // –û–¢–ö–†–´–í–ê–ï–ú –í–°–ï –ü–ï–ù–¨–ö–ò –£ –í–°–ï–• –ò–ì–†–û–ö–û–í[m
[32m+[m[32m          if (p.penki.length > 0) {[m
[32m+[m[32m            console.log(`üÉè [–°—Ç–∞–¥–∏—è 2] –û—Ç–∫—Ä—ã–≤–∞–µ–º –ø–µ–Ω—å–∫–∏ —É ${p.name}:`, p.penki.map(c => c.image));[m
             const activatedPenki = p.penki.map(card => ({[m
               ...card,[m
               open: true[m
             }));[m
             p.cards = [...p.cards, ...activatedPenki];[m
             p.penki = [];[m
[31m-            console.log(`üÉè [checkStage1End] ‚úÖ –ü–µ–Ω—å–∫–∏ –∏–≥—Ä–æ–∫–∞ ${p.name} –æ—Ç–∫—Ä—ã—Ç—ã:`, p.cards.map(c => c.image));[m
           }[m
         });[m
         [m
[36m@@ -1181,14 +1168,33 @@[m [mexport const useGameStore = create<GameState>()([m
           availableTargets: [],[m
           canPlaceOnSelf: false,[m
           mustDrawFromDeck: false,[m
[31m-          trumpSuit: trumpSuit,[m
[31m-          currentPlayerId: startingPlayerId,[m
[31m-          players: [...players],[m
[31m-          currentRound: 1 // –°–±—Ä–∞—Å—ã–≤–∞–µ–º —Ä–∞—É–Ω–¥—ã –¥–ª—è –Ω–æ–≤–æ–π —Å—Ç–∞–¥–∏–∏[m
[32m+[m[32m          currentPlayerId: null, // –í–æ 2-–π —Å—Ç–∞–¥–∏–∏ –ù–ï–¢ —Ç–µ–∫—É—â–µ–≥–æ –∏–≥—Ä–æ–∫–∞[m
[32m+[m[32m          players: [...players][m
         });[m
         [m
[31m-        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º 2-—é —Å—Ç–∞–¥–∏—é[m
[31m-        get().initializeStage2();[m
[32m+[m[32m        // –ß–µ—Ä–µ–∑ 2 —Å–µ–∫—É–Ω–¥—ã –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–µ—Ä–µ—Ö–æ–¥–∏–º –∫ —Å—Ç–∞–¥–∏–∏ 3 (–∏–≥—Ä–∞)[m
[32m+[m[32m        setTimeout(() => {[m
[32m+[m[32m          console.log(`üéØ [–°—Ç–∞–¥–∏—è 2] ‚úÖ –ü–µ–Ω—å–∫–∏ –æ—Ç–∫—Ä—ã—Ç—ã! –ü–µ—Ä–µ—Ö–æ–¥ –∫ —Å—Ç–∞–¥–∏–∏ 3 (–ò–ì–†–ê)...`);[m
[32m+[m[41m          [m
[32m+[m[32m          const trumpSuit = get().determineTrumpSuit();[m
[32m+[m[32m          console.log(`üéØ [–°—Ç–∞–¥–∏—è 3] –ö–æ–∑—ã—Ä—å –æ–ø—Ä–µ–¥–µ–ª–µ–Ω: ${trumpSuit || '–ù–ï–¢'}`);[m
[32m+[m[41m          [m
[32m+[m[32m          const { players: currentPlayers } = get();[m
[32m+[m[32m          currentPlayers.forEach(p => {[m
[32m+[m[32m            p.playerStage = 3; // –í—Å–µ –ø–µ—Ä–µ—Ö–æ–¥—è—Ç –≤ 3-—é —Å—Ç–∞–¥–∏—é[m
[32m+[m[32m            p.isCurrentPlayer = p.id === startingPlayerId;[m
[32m+[m[32m          });[m
[32m+[m[41m          [m
[32m+[m[32m          set({[m
[32m+[m[32m            gameStage: 3,[m
[32m+[m[32m            trumpSuit: trumpSuit,[m
[32m+[m[32m            currentPlayerId: startingPlayerId,[m
[32m+[m[32m            players: [...currentPlayers][m
[32m+[m[32m          });[m
[32m+[m[41m          [m
[32m+[m[32m          // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º 3-—é —Å—Ç–∞–¥–∏—é (–∏–≥—Ä–∞)[m
[32m+[m[32m          get().initializeStage2(); // –§—É–Ω–∫—Ü–∏—è –Ω–∞–∑—ã–≤–∞–µ—Ç—Å—è initializeStage2, –Ω–æ —Ç–µ–ø–µ—Ä—å –¥–ª—è —Å—Ç–∞–¥–∏–∏ 3[m
[32m+[m[32m        }, 2000);[m
         [m
         // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –∏ –°–†–ê–ó–£ –∑–∞–ø—É—Å–∫–∞–µ–º —Ö–æ–¥[m
         get().showNotification('üéâ –ü–µ—Ä–≤–∞—è —Å—Ç–∞–¥–∏—è –∑–∞–≤–µ—Ä—à–µ–Ω–∞!', 'success', 3000);[m
